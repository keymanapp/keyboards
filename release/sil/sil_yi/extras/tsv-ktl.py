"""
Reads yi.csv and creates yi.txt, which can be pasted into .keyman-touch-layout file
DLR 2025-10-08
"""

import csv
import json

SpKey =   { "NL": ("K_ENTER", "*Enter*", 1, "default"),
            "GL": ("K_LOPT", "*Menu*", 1, ""),
            "BK": ("K_BKSP", "*BkSp*", 1, ""),
            "BS": ("T_BKSP", "*BkSp*", 1, "default"),
            "NM": ("K_NUMERALS", "#.?", 1, "numeric"),
            "NX": ("K_NUMERALS", "#.?", 2, "default"),
            "SP": ("K_SPACE", "", 1, "") }

Punct = { "#": ("U_0023", ""),
          "%": ("U_0025", ""),
          "*": ("U_002A", ""),
          "+": ("U_002B", ""),
          "-": ("U_002D", ""),
          "0": ("U_0030", ""),
          "1": ("U_0031", ""),
          "2": ("U_0032", ""),
          "3": ("U_0033", ""),
          "4": ("U_0034", ""),
          "5": ("U_0035", ""),
          "6": ("U_0036", ""),
          "7": ("U_0037", ""),
          "8": ("U_0038", ""),
          "9": ("U_0039", ""),
          "=": ("U_003D", ""),
          "_": ("U_005F", ""),
          "~": ("U_007E", ""),
          "‘": ("U_2018", ""),
          "’": ("U_2019", ""),
          "“": ("U_201C", ""),
          "”": ("U_201D", ""),
          "…": ("U_2026", ""),
          "、": ("U_3001", "default"),
          "。": ("U_3002", "default"),
          "〈": ("U_3008", ""),
          "〉": ("U_3009", ""),
          "《": ("U_300A", ""),
          "》": ("U_300B", ""),
          "！": ("U_FF01", "default"),
          "（": ("U_FF08", ""),
          "）": ("U_FF09", ""),
          "，": ("U_FF0C", "default"),
          "／": ("U_FF0F", ""),
          "：": ("U_FF1A", "default"),
          "；": ("U_FF1B", "default"),
          "？": ("U_FF1F", "default"),
          "［": ("U_FF3B", ""),
          "］": ("U_FF3D", ""),
          "｛": ("U_FF5B", ""),
          "｜": ("U_FF5C", ""),
          "｝": ("U_FF5D", "") }

YiTable = { "it": "A000",
"ix": "A001",
"i": "A002",
"ip": "A003",
"iet": "A004",
"iex": "A005",
"ie": "A006",
"iep": "A007",
"at": "A008",
"ax": "A009",
"a": "A00A",
"ap": "A00B",
"uox": "A00C",
"uo": "A00D",
"uop": "A00E",
"ot": "A00F",
"ox": "A010",
"o": "A011",
"op": "A012",
"ex": "A013",
"e": "A014",
"w": "A015",    # syllable duplication sign; official name is "wu"; transcription is "w" 
"bit": "A016",
"bix": "A017",
"bi": "A018",
"bip": "A019",
"biet": "A01A",
"biex": "A01B",
"bie": "A01C",
"biep": "A01D",
"bat": "A01E",
"bax": "A01F",
"ba": "A020",
"bap": "A021",
"buox": "A022",
"buo": "A023",
"buop": "A024",
"bot": "A025",
"box": "A026",
"bo": "A027",
"bop": "A028",
"bex": "A029",
"be": "A02A",
"bep": "A02B",
"but": "A02C",
"bux": "A02D",
"bu": "A02E",
"bup": "A02F",
"burx": "A030",
"bur": "A031",
"byt": "A032",
"byx": "A033",
"by": "A034",
"byp": "A035",
"byrx": "A036",
"byr": "A037",
"pit": "A038",
"pix": "A039",
"pi": "A03A",
"pip": "A03B",
"piex": "A03C",
"pie": "A03D",
"piep": "A03E",
"pat": "A03F",
"pax": "A040",
"pa": "A041",
"pap": "A042",
"puox": "A043",
"puo": "A044",
"puop": "A045",
"pot": "A046",
"pox": "A047",
"po": "A048",
"pop": "A049",
"put": "A04A",
"pux": "A04B",
"pu": "A04C",
"pup": "A04D",
"purx": "A04E",
"pur": "A04F",
"pyt": "A050",
"pyx": "A051",
"py": "A052",
"pyp": "A053",
"pyrx": "A054",
"pyr": "A055",
"bbit": "A056",
"bbix": "A057",
"bbi": "A058",
"bbip": "A059",
"bbiet": "A05A",
"bbiex": "A05B",
"bbie": "A05C",
"bbiep": "A05D",
"bbat": "A05E",
"bbax": "A05F",
"bba": "A060",
"bbap": "A061",
"bbuox": "A062",
"bbuo": "A063",
"bbuop": "A064",
"bbot": "A065",
"bbox": "A066",
"bbo": "A067",
"bbop": "A068",
"bbex": "A069",
"bbe": "A06A",
"bbep": "A06B",
"bbut": "A06C",
"bbux": "A06D",
"bbu": "A06E",
"bbup": "A06F",
"bburx": "A070",
"bbur": "A071",
"bbyt": "A072",
"bbyx": "A073",
"bby": "A074",
"bbyp": "A075",
"nbit": "A076",
"nbix": "A077",
"nbi": "A078",
"nbip": "A079",
"nbiex": "A07A",
"nbie": "A07B",
"nbiep": "A07C",
"nbat": "A07D",
"nbax": "A07E",
"nba": "A07F",
"nbap": "A080",
"nbot": "A081",
"nbox": "A082",
"nbo": "A083",
"nbop": "A084",
"nbut": "A085",
"nbux": "A086",
"nbu": "A087",
"nbup": "A088",
"nburx": "A089",
"nbur": "A08A",
"nbyt": "A08B",
"nbyx": "A08C",
"nby": "A08D",
"nbyp": "A08E",
"nbyrx": "A08F",
"nbyr": "A090",
"hmit": "A091",
"hmix": "A092",
"hmi": "A093",
"hmip": "A094",
"hmiex": "A095",
"hmie": "A096",
"hmiep": "A097",
"hmat": "A098",
"hmax": "A099",
"hma": "A09A",
"hmap": "A09B",
"hmuox": "A09C",
"hmuo": "A09D",
"hmuop": "A09E",
"hmot": "A09F",
"hmox": "A0A0",
"hmo": "A0A1",
"hmop": "A0A2",
"hmut": "A0A3",
"hmux": "A0A4",
"hmu": "A0A5",
"hmup": "A0A6",
"hmurx": "A0A7",
"hmur": "A0A8",
"hmyx": "A0A9",
"hmy": "A0AA",
"hmyp": "A0AB",
"hmyrx": "A0AC",
"hmyr": "A0AD",
"mit": "A0AE",
"mix": "A0AF",
"mi": "A0B0",
"mip": "A0B1",
"miex": "A0B2",
"mie": "A0B3",
"miep": "A0B4",
"mat": "A0B5",
"max": "A0B6",
"ma": "A0B7",
"map": "A0B8",
"muot": "A0B9",
"muox": "A0BA",
"muo": "A0BB",
"muop": "A0BC",
"mot": "A0BD",
"mox": "A0BE",
"mo": "A0BF",
"mop": "A0C0",
"mex": "A0C1",
"me": "A0C2",
"mut": "A0C3",
"mux": "A0C4",
"mu": "A0C5",
"mup": "A0C6",
"murx": "A0C7",
"mur": "A0C8",
"myt": "A0C9",
"myx": "A0CA",
"my": "A0CB",
"myp": "A0CC",
"fit": "A0CD",
"fix": "A0CE",
"fi": "A0CF",
"fip": "A0D0",
"fat": "A0D1",
"fax": "A0D2",
"fa": "A0D3",
"fap": "A0D4",
"fox": "A0D5",
"fo": "A0D6",
"fop": "A0D7",
"fut": "A0D8",
"fux": "A0D9",
"fu": "A0DA",
"fup": "A0DB",
"furx": "A0DC",
"fur": "A0DD",
"fyt": "A0DE",
"fyx": "A0DF",
"fy": "A0E0",
"fyp": "A0E1",
"vit": "A0E2",
"vix": "A0E3",
"vi": "A0E4",
"vip": "A0E5",
"viet": "A0E6",
"viex": "A0E7",
"vie": "A0E8",
"viep": "A0E9",
"vat": "A0EA",
"vax": "A0EB",
"va": "A0EC",
"vap": "A0ED",
"vot": "A0EE",
"vox": "A0EF",
"vo": "A0F0",
"vop": "A0F1",
"vex": "A0F2",
"vep": "A0F3",
"vut": "A0F4",
"vux": "A0F5",
"vu": "A0F6",
"vup": "A0F7",
"vurx": "A0F8",
"vur": "A0F9",
"vyt": "A0FA",
"vyx": "A0FB",
"vy": "A0FC",
"vyp": "A0FD",
"vyrx": "A0FE",
"vyr": "A0FF",
"dit": "A100",
"dix": "A101",
"di": "A102",
"dip": "A103",
"diex": "A104",
"die": "A105",
"diep": "A106",
"dat": "A107",
"dax": "A108",
"da": "A109",
"dap": "A10A",
"duox": "A10B",
"duo": "A10C",
"dot": "A10D",
"dox": "A10E",
"do": "A10F",
"dop": "A110",
"dex": "A111",
"de": "A112",
"dep": "A113",
"dut": "A114",
"dux": "A115",
"du": "A116",
"dup": "A117",
"durx": "A118",
"dur": "A119",
"tit": "A11A",
"tix": "A11B",
"ti": "A11C",
"tip": "A11D",
"tiex": "A11E",
"tie": "A11F",
"tiep": "A120",
"tat": "A121",
"tax": "A122",
"ta": "A123",
"tap": "A124",
"tuot": "A125",
"tuox": "A126",
"tuo": "A127",
"tuop": "A128",
"tot": "A129",
"tox": "A12A",
"to": "A12B",
"top": "A12C",
"tex": "A12D",
"te": "A12E",
"tep": "A12F",
"tut": "A130",
"tux": "A131",
"tu": "A132",
"tup": "A133",
"turx": "A134",
"tur": "A135",
"ddit": "A136",
"ddix": "A137",
"ddi": "A138",
"ddip": "A139",
"ddiex": "A13A",
"ddie": "A13B",
"ddiep": "A13C",
"ddat": "A13D",
"ddax": "A13E",
"dda": "A13F",
"ddap": "A140",
"dduox": "A141",
"dduo": "A142",
"dduop": "A143",
"ddot": "A144",
"ddox": "A145",
"ddo": "A146",
"ddop": "A147",
"ddex": "A148",
"dde": "A149",
"ddep": "A14A",
"ddut": "A14B",
"ddux": "A14C",
"ddu": "A14D",
"ddup": "A14E",
"ddurx": "A14F",
"ddur": "A150",
"ndit": "A151",
"ndix": "A152",
"ndi": "A153",
"ndip": "A154",
"ndiex": "A155",
"ndie": "A156",
"ndat": "A157",
"ndax": "A158",
"nda": "A159",
"ndap": "A15A",
"ndot": "A15B",
"ndox": "A15C",
"ndo": "A15D",
"ndop": "A15E",
"ndex": "A15F",
"nde": "A160",
"ndep": "A161",
"ndut": "A162",
"ndux": "A163",
"ndu": "A164",
"ndup": "A165",
"ndurx": "A166",
"ndur": "A167",
"hnit": "A168",
"hnix": "A169",
"hni": "A16A",
"hnip": "A16B",
"hniet": "A16C",
"hniex": "A16D",
"hnie": "A16E",
"hniep": "A16F",
"hnat": "A170",
"hnax": "A171",
"hna": "A172",
"hnap": "A173",
"hnuox": "A174",
"hnuo": "A175",
"hnot": "A176",
"hnox": "A177",
"hnop": "A178",
"hnex": "A179",
"hne": "A17A",
"hnep": "A17B",
"hnut": "A17C",
"nit": "A17D",
"nix": "A17E",
"ni": "A17F",
"nip": "A180",
"niex": "A181",
"nie": "A182",
"niep": "A183",
"nax": "A184",
"na": "A185",
"nap": "A186",
"nuox": "A187",
"nuo": "A188",
"nuop": "A189",
"not": "A18A",
"nox": "A18B",
"no": "A18C",
"nop": "A18D",
"nex": "A18E",
"ne": "A18F",
"nep": "A190",
"nut": "A191",
"nux": "A192",
"nu": "A193",
"nup": "A194",
"nurx": "A195",
"nur": "A196",
"hlit": "A197",
"hlix": "A198",
"hli": "A199",
"hlip": "A19A",
"hliex": "A19B",
"hlie": "A19C",
"hliep": "A19D",
"hlat": "A19E",
"hlax": "A19F",
"hla": "A1A0",
"hlap": "A1A1",
"hluox": "A1A2",
"hluo": "A1A3",
"hluop": "A1A4",
"hlox": "A1A5",
"hlo": "A1A6",
"hlop": "A1A7",
"hlex": "A1A8",
"hle": "A1A9",
"hlep": "A1AA",
"hlut": "A1AB",
"hlux": "A1AC",
"hlu": "A1AD",
"hlup": "A1AE",
"hlurx": "A1AF",
"hlur": "A1B0",
"hlyt": "A1B1",
"hlyx": "A1B2",
"hly": "A1B3",
"hlyp": "A1B4",
"hlyrx": "A1B5",
"hlyr": "A1B6",
"lit": "A1B7",
"lix": "A1B8",
"li": "A1B9",
"lip": "A1BA",
"liet": "A1BB",
"liex": "A1BC",
"lie": "A1BD",
"liep": "A1BE",
"lat": "A1BF",
"lax": "A1C0",
"la": "A1C1",
"lap": "A1C2",
"luot": "A1C3",
"luox": "A1C4",
"luo": "A1C5",
"luop": "A1C6",
"lot": "A1C7",
"lox": "A1C8",
"lo": "A1C9",
"lop": "A1CA",
"lex": "A1CB",
"le": "A1CC",
"lep": "A1CD",
"lut": "A1CE",
"lux": "A1CF",
"lu": "A1D0",
"lup": "A1D1",
"lurx": "A1D2",
"lur": "A1D3",
"lyt": "A1D4",
"lyx": "A1D5",
"ly": "A1D6",
"lyp": "A1D7",
"lyrx": "A1D8",
"lyr": "A1D9",
"git": "A1DA",
"gix": "A1DB",
"gi": "A1DC",
"gip": "A1DD",
"giet": "A1DE",
"giex": "A1DF",
"gie": "A1E0",
"giep": "A1E1",
"gat": "A1E2",
"gax": "A1E3",
"ga": "A1E4",
"gap": "A1E5",
"guot": "A1E6",
"guox": "A1E7",
"guo": "A1E8",
"guop": "A1E9",
"got": "A1EA",
"gox": "A1EB",
"go": "A1EC",
"gop": "A1ED",
"get": "A1EE",
"gex": "A1EF",
"ge": "A1F0",
"gep": "A1F1",
"gut": "A1F2",
"gux": "A1F3",
"gu": "A1F4",
"gup": "A1F5",
"gurx": "A1F6",
"gur": "A1F7",
"kit": "A1F8",
"kix": "A1F9",
"ki": "A1FA",
"kip": "A1FB",
"kiex": "A1FC",
"kie": "A1FD",
"kiep": "A1FE",
"kat": "A1FF",
"kax": "A200",
"ka": "A201",
"kap": "A202",
"kuox": "A203",
"kuo": "A204",
"kuop": "A205",
"kot": "A206",
"kox": "A207",
"ko": "A208",
"kop": "A209",
"ket": "A20A",
"kex": "A20B",
"ke": "A20C",
"kep": "A20D",
"kut": "A20E",
"kux": "A20F",
"ku": "A210",
"kup": "A211",
"kurx": "A212",
"kur": "A213",
"ggit": "A214",
"ggix": "A215",
"ggi": "A216",
"ggiex": "A217",
"ggie": "A218",
"ggiep": "A219",
"ggat": "A21A",
"ggax": "A21B",
"gga": "A21C",
"ggap": "A21D",
"gguot": "A21E",
"gguox": "A21F",
"gguo": "A220",
"gguop": "A221",
"ggot": "A222",
"ggox": "A223",
"ggo": "A224",
"ggop": "A225",
"gget": "A226",
"ggex": "A227",
"gge": "A228",
"ggep": "A229",
"ggut": "A22A",
"ggux": "A22B",
"ggu": "A22C",
"ggup": "A22D",
"ggurx": "A22E",
"ggur": "A22F",
"mgiex": "A230",
"mgie": "A231",
"mgat": "A232",
"mgax": "A233",
"mga": "A234",
"mgap": "A235",
"mguox": "A236",
"mguo": "A237",
"mguop": "A238",
"mgot": "A239",
"mgox": "A23A",
"mgo": "A23B",
"mgop": "A23C",
"mgex": "A23D",
"mge": "A23E",
"mgep": "A23F",
"mgut": "A240",
"mgux": "A241",
"mgu": "A242",
"mgup": "A243",
"mgurx": "A244",
"mgur": "A245",
"hxit": "A246",
"hxix": "A247",
"hxi": "A248",
"hxip": "A249",
"hxiet": "A24A",
"hxiex": "A24B",
"hxie": "A24C",
"hxiep": "A24D",
"hxat": "A24E",
"hxax": "A24F",
"hxa": "A250",
"hxap": "A251",
"hxuot": "A252",
"hxuox": "A253",
"hxuo": "A254",
"hxuop": "A255",
"hxot": "A256",
"hxox": "A257",
"hxo": "A258",
"hxop": "A259",
"hxex": "A25A",
"hxe": "A25B",
"hxep": "A25C",
"ngiex": "A25D",
"ngie": "A25E",
"ngiep": "A25F",
"ngat": "A260",
"ngax": "A261",
"nga": "A262",
"ngap": "A263",
"nguot": "A264",
"nguox": "A265",
"nguo": "A266",
"ngot": "A267",
"ngox": "A268",
"ngo": "A269",
"ngop": "A26A",
"ngex": "A26B",
"nge": "A26C",
"ngep": "A26D",
"hit": "A26E",
"hiex": "A26F",
"hie": "A270",
"hat": "A271",
"hax": "A272",
"ha": "A273",
"hap": "A274",
"huot": "A275",
"huox": "A276",
"huo": "A277",
"huop": "A278",
"hot": "A279",
"hox": "A27A",
"ho": "A27B",
"hop": "A27C",
"hex": "A27D",
"he": "A27E",
"hep": "A27F",
"wat": "A280",
"wax": "A281",
"wa": "A282",
"wap": "A283",
"wuox": "A284",
"wuo": "A285",
"wuop": "A286",
"wox": "A287",
"wo": "A288",
"wop": "A289",
"wex": "A28A",
"we": "A28B",
"wep": "A28C",
"zit": "A28D",
"zix": "A28E",
"zi": "A28F",
"zip": "A290",
"ziex": "A291",
"zie": "A292",
"ziep": "A293",
"zat": "A294",
"zax": "A295",
"za": "A296",
"zap": "A297",
"zuox": "A298",
"zuo": "A299",
"zuop": "A29A",
"zot": "A29B",
"zox": "A29C",
"zo": "A29D",
"zop": "A29E",
"zex": "A29F",
"ze": "A2A0",
"zep": "A2A1",
"zut": "A2A2",
"zux": "A2A3",
"zu": "A2A4",
"zup": "A2A5",
"zurx": "A2A6",
"zur": "A2A7",
"zyt": "A2A8",
"zyx": "A2A9",
"zy": "A2AA",
"zyp": "A2AB",
"zyrx": "A2AC",
"zyr": "A2AD",
"cit": "A2AE",
"cix": "A2AF",
"ci": "A2B0",
"cip": "A2B1",
"ciet": "A2B2",
"ciex": "A2B3",
"cie": "A2B4",
"ciep": "A2B5",
"cat": "A2B6",
"cax": "A2B7",
"ca": "A2B8",
"cap": "A2B9",
"cuox": "A2BA",
"cuo": "A2BB",
"cuop": "A2BC",
"cot": "A2BD",
"cox": "A2BE",
"co": "A2BF",
"cop": "A2C0",
"cex": "A2C1",
"ce": "A2C2",
"cep": "A2C3",
"cut": "A2C4",
"cux": "A2C5",
"cu": "A2C6",
"cup": "A2C7",
"curx": "A2C8",
"cur": "A2C9",
"cyt": "A2CA",
"cyx": "A2CB",
"cy": "A2CC",
"cyp": "A2CD",
"cyrx": "A2CE",
"cyr": "A2CF",
"zzit": "A2D0",
"zzix": "A2D1",
"zzi": "A2D2",
"zzip": "A2D3",
"zziet": "A2D4",
"zziex": "A2D5",
"zzie": "A2D6",
"zziep": "A2D7",
"zzat": "A2D8",
"zzax": "A2D9",
"zza": "A2DA",
"zzap": "A2DB",
"zzox": "A2DC",
"zzo": "A2DD",
"zzop": "A2DE",
"zzex": "A2DF",
"zze": "A2E0",
"zzep": "A2E1",
"zzux": "A2E2",
"zzu": "A2E3",
"zzup": "A2E4",
"zzurx": "A2E5",
"zzur": "A2E6",
"zzyt": "A2E7",
"zzyx": "A2E8",
"zzy": "A2E9",
"zzyp": "A2EA",
"zzyrx": "A2EB",
"zzyr": "A2EC",
"nzit": "A2ED",
"nzix": "A2EE",
"nzi": "A2EF",
"nzip": "A2F0",
"nziex": "A2F1",
"nzie": "A2F2",
"nziep": "A2F3",
"nzat": "A2F4",
"nzax": "A2F5",
"nza": "A2F6",
"nzap": "A2F7",
"nzuox": "A2F8",
"nzuo": "A2F9",
"nzox": "A2FA",
"nzop": "A2FB",
"nzex": "A2FC",
"nze": "A2FD",
"nzux": "A2FE",
"nzu": "A2FF",
"nzup": "A300",
"nzurx": "A301",
"nzur": "A302",
"nzyt": "A303",
"nzyx": "A304",
"nzy": "A305",
"nzyp": "A306",
"nzyrx": "A307",
"nzyr": "A308",
"sit": "A309",
"six": "A30A",
"si": "A30B",
"sip": "A30C",
"siex": "A30D",
"sie": "A30E",
"siep": "A30F",
"sat": "A310",
"sax": "A311",
"sa": "A312",
"sap": "A313",
"suox": "A314",
"suo": "A315",
"suop": "A316",
"sot": "A317",
"sox": "A318",
"so": "A319",
"sop": "A31A",
"sex": "A31B",
"se": "A31C",
"sep": "A31D",
"sut": "A31E",
"sux": "A31F",
"su": "A320",
"sup": "A321",
"surx": "A322",
"sur": "A323",
"syt": "A324",
"syx": "A325",
"sy": "A326",
"syp": "A327",
"syrx": "A328",
"syr": "A329",
"ssit": "A32A",
"ssix": "A32B",
"ssi": "A32C",
"ssip": "A32D",
"ssiex": "A32E",
"ssie": "A32F",
"ssiep": "A330",
"ssat": "A331",
"ssax": "A332",
"ssa": "A333",
"ssap": "A334",
"ssot": "A335",
"ssox": "A336",
"sso": "A337",
"ssop": "A338",
"ssex": "A339",
"sse": "A33A",
"ssep": "A33B",
"ssut": "A33C",
"ssux": "A33D",
"ssu": "A33E",
"ssup": "A33F",
"ssyt": "A340",
"ssyx": "A341",
"ssy": "A342",
"ssyp": "A343",
"ssyrx": "A344",
"ssyr": "A345",
"zhat": "A346",
"zhax": "A347",
"zha": "A348",
"zhap": "A349",
"zhuox": "A34A",
"zhuo": "A34B",
"zhuop": "A34C",
"zhot": "A34D",
"zhox": "A34E",
"zho": "A34F",
"zhop": "A350",
"zhet": "A351",
"zhex": "A352",
"zhe": "A353",
"zhep": "A354",
"zhut": "A355",
"zhux": "A356",
"zhu": "A357",
"zhup": "A358",
"zhurx": "A359",
"zhur": "A35A",
"zhyt": "A35B",
"zhyx": "A35C",
"zhy": "A35D",
"zhyp": "A35E",
"zhyrx": "A35F",
"zhyr": "A360",
"chat": "A361",
"chax": "A362",
"cha": "A363",
"chap": "A364",
"chuot": "A365",
"chuox": "A366",
"chuo": "A367",
"chuop": "A368",
"chot": "A369",
"chox": "A36A",
"cho": "A36B",
"chop": "A36C",
"chet": "A36D",
"chex": "A36E",
"che": "A36F",
"chep": "A370",
"chux": "A371",
"chu": "A372",
"chup": "A373",
"churx": "A374",
"chur": "A375",
"chyt": "A376",
"chyx": "A377",
"chy": "A378",
"chyp": "A379",
"chyrx": "A37A",
"chyr": "A37B",
"rrax": "A37C",
"rra": "A37D",
"rruox": "A37E",
"rruo": "A37F",
"rrot": "A380",
"rrox": "A381",
"rro": "A382",
"rrop": "A383",
"rret": "A384",
"rrex": "A385",
"rre": "A386",
"rrep": "A387",
"rrut": "A388",
"rrux": "A389",
"rru": "A38A",
"rrup": "A38B",
"rrurx": "A38C",
"rrur": "A38D",
"rryt": "A38E",
"rryx": "A38F",
"rry": "A390",
"rryp": "A391",
"rryrx": "A392",
"rryr": "A393",
"nrat": "A394",
"nrax": "A395",
"nra": "A396",
"nrap": "A397",
"nrox": "A398",
"nro": "A399",
"nrop": "A39A",
"nret": "A39B",
"nrex": "A39C",
"nre": "A39D",
"nrep": "A39E",
"nrut": "A39F",
"nrux": "A3A0",
"nru": "A3A1",
"nrup": "A3A2",
"nrurx": "A3A3",
"nrur": "A3A4",
"nryt": "A3A5",
"nryx": "A3A6",
"nry": "A3A7",
"nryp": "A3A8",
"nryrx": "A3A9",
"nryr": "A3AA",
"shat": "A3AB",
"shax": "A3AC",
"sha": "A3AD",
"shap": "A3AE",
"shuox": "A3AF",
"shuo": "A3B0",
"shuop": "A3B1",
"shot": "A3B2",
"shox": "A3B3",
"sho": "A3B4",
"shop": "A3B5",
"shet": "A3B6",
"shex": "A3B7",
"she": "A3B8",
"shep": "A3B9",
"shut": "A3BA",
"shux": "A3BB",
"shu": "A3BC",
"shup": "A3BD",
"shurx": "A3BE",
"shur": "A3BF",
"shyt": "A3C0",
"shyx": "A3C1",
"shy": "A3C2",
"shyp": "A3C3",
"shyrx": "A3C4",
"shyr": "A3C5",
"rat": "A3C6",
"rax": "A3C7",
"ra": "A3C8",
"rap": "A3C9",
"ruox": "A3CA",
"ruo": "A3CB",
"ruop": "A3CC",
"rot": "A3CD",
"rox": "A3CE",
"ro": "A3CF",
"rop": "A3D0",
"rex": "A3D1",
"re": "A3D2",
"rep": "A3D3",
"rut": "A3D4",
"rux": "A3D5",
"ru": "A3D6",
"rup": "A3D7",
"rurx": "A3D8",
"rur": "A3D9",
"ryt": "A3DA",
"ryx": "A3DB",
"ry": "A3DC",
"ryp": "A3DD",
"ryrx": "A3DE",
"ryr": "A3DF",
"jit": "A3E0",
"jix": "A3E1",
"ji": "A3E2",
"jip": "A3E3",
"jiet": "A3E4",
"jiex": "A3E5",
"jie": "A3E6",
"jiep": "A3E7",
"juot": "A3E8",
"juox": "A3E9",
"juo": "A3EA",
"juop": "A3EB",
"jot": "A3EC",
"jox": "A3ED",
"jo": "A3EE",
"jop": "A3EF",
"jut": "A3F0",
"jux": "A3F1",
"ju": "A3F2",
"jup": "A3F3",
"jurx": "A3F4",
"jur": "A3F5",
"jyt": "A3F6",
"jyx": "A3F7",
"jy": "A3F8",
"jyp": "A3F9",
"jyrx": "A3FA",
"jyr": "A3FB",
"qit": "A3FC",
"qix": "A3FD",
"qi": "A3FE",
"qip": "A3FF",
"qiet": "A400",
"qiex": "A401",
"qie": "A402",
"qiep": "A403",
"quot": "A404",
"quox": "A405",
"quo": "A406",
"quop": "A407",
"qot": "A408",
"qox": "A409",
"qo": "A40A",
"qop": "A40B",
"qut": "A40C",
"qux": "A40D",
"qu": "A40E",
"qup": "A40F",
"qurx": "A410",
"qur": "A411",
"qyt": "A412",
"qyx": "A413",
"qy": "A414",
"qyp": "A415",
"qyrx": "A416",
"qyr": "A417",
"jjit": "A418",
"jjix": "A419",
"jji": "A41A",
"jjip": "A41B",
"jjiet": "A41C",
"jjiex": "A41D",
"jjie": "A41E",
"jjiep": "A41F",
"jjuox": "A420",
"jjuo": "A421",
"jjuop": "A422",
"jjot": "A423",
"jjox": "A424",
"jjo": "A425",
"jjop": "A426",
"jjut": "A427",
"jjux": "A428",
"jju": "A429",
"jjup": "A42A",
"jjurx": "A42B",
"jjur": "A42C",
"jjyt": "A42D",
"jjyx": "A42E",
"jjy": "A42F",
"jjyp": "A430",
"njit": "A431",
"njix": "A432",
"nji": "A433",
"njip": "A434",
"njiet": "A435",
"njiex": "A436",
"njie": "A437",
"njiep": "A438",
"njuox": "A439",
"njuo": "A43A",
"njot": "A43B",
"njox": "A43C",
"njo": "A43D",
"njop": "A43E",
"njux": "A43F",
"nju": "A440",
"njup": "A441",
"njurx": "A442",
"njur": "A443",
"njyt": "A444",
"njyx": "A445",
"njy": "A446",
"njyp": "A447",
"njyrx": "A448",
"njyr": "A449",
"nyit": "A44A",
"nyix": "A44B",
"nyi": "A44C",
"nyip": "A44D",
"nyiet": "A44E",
"nyiex": "A44F",
"nyie": "A450",
"nyiep": "A451",
"nyuox": "A452",
"nyuo": "A453",
"nyuop": "A454",
"nyot": "A455",
"nyox": "A456",
"nyo": "A457",
"nyop": "A458",
"nyut": "A459",
"nyux": "A45A",
"nyu": "A45B",
"nyup": "A45C",
"xit": "A45D",
"xix": "A45E",
"xi": "A45F",
"xip": "A460",
"xiet": "A461",
"xiex": "A462",
"xie": "A463",
"xiep": "A464",
"xuox": "A465",
"xuo": "A466",
"xot": "A467",
"xox": "A468",
"xo": "A469",
"xop": "A46A",
"xyt": "A46B",
"xyx": "A46C",
"xy": "A46D",
"xyp": "A46E",
"xyrx": "A46F",
"xyr": "A470",
"yit": "A471",
"yix": "A472",
"yi": "A473",
"yip": "A474",
"yiet": "A475",
"yiex": "A476",
"yie": "A477",
"yiep": "A478",
"yuot": "A479",
"yuox": "A47A",
"yuo": "A47B",
"yuop": "A47C",
"yot": "A47D",
"yox": "A47E",
"yo": "A47F",
"yop": "A480",
"yut": "A481",
"yux": "A482",
"yu": "A483",
"yup": "A484",
"yurx": "A485",
"yur": "A486",
"yyt": "A487",
"yyx": "A488",
"yy": "A489",
"yyp": "A48A",
"yyrx": "A48B",
"yyr": "A48C" }

def dictforkey(s, layer):   # Create dictionary of JSON fields for Keyman for the specific key "s" on layer "layer"
    d = {}
    if s in SpKey:
        d["id"] = SpKey[s][0]
        d["text"] = SpKey[s][1]
        if SpKey[s][2] > 0:
            d["sp"] = SpKey[s][2]
        if SpKey[s][3] != "":
            d["nextlayer"] = SpKey[s][3]
        if s == "NM" and layer != "radicals":
            d["sk"] = []
            d["sk"].append({"id": "T_RAD", "text": "꒐꒑꒒꒔", "nextlayer": "radicals"})
            d["multitap"] = []
            d["multitap"].append({"id": "T_RAD", "text": "꒐꒑꒒꒔", "nextlayer": "radicals"})
    elif s in YiTable and (s != "w" or layer != "default"):
        d["id"] = "U_" + YiTable[s]
        d["text"] = chr(int(YiTable[s], 16)) # key label is Yi syll char
        d["hint"] = s # hint is Yi Pinyin spelling of syll char
        d["nextlayer"] = "default"
    elif s in Punct:
        d["id"] = Punct[s][0]
        d["text"] = s
        if Punct[s][1] != "":
            d["nextlayer"] = Punct[s][1]
    elif s == "":
        d["id"] = "T_null"
        # d["sp"] = 10 # 10="spacer" (empty space); 9="blank" (gray box); 0 (or not present) = empty key
    else:   # should only occur on default layer
        d["id"] = "T_" + s
        d["text"] = s if s != "NC" else "Ø" 
        d["nextlayer"] = "default"  # nextlayer will be patched in if the layer exists
    return(d)

tsvfile = open('yi.csv', encoding='utf-8')
tsvreader = csv.reader(tsvfile, dialect='excel-tab')

jsondata = {}
jsondata["layer"] = []

previouslayer = ""
layernames = {}
for x in tsvreader:
    if x[0] != "" and x[0] != previouslayer:
        previouslayer = x[0]
        layernames[x[0]] = len(jsondata["layer"])
        jsondata["layer"].append({})
        jsondata["layer"][-1]["id"] = x[0]
        jsondata["layer"][-1]["row"] = []
        row = 0
    if x[0] == "" and x[1] == "" and x[2] == "": # first three cells blank implies empty line
        continue
    jsondata["layer"][-1]["row"].append({})
    jsondata["layer"][-1]["row"][row]["id"] = row + 1
    jsondata["layer"][-1]["row"][row]["key"] = []
    for y in x[1:]:
        jsondata["layer"][-1]["row"][row]["key"].append(dictforkey(y, jsondata["layer"][-1]["id"]))
    row += 1

# link keys on default layer to layers (if they exist)
for r in jsondata["layer"][0]["row"]:
    for k in r["key"]:
        lname = k["id"][2:]
        if lname in layernames:
            k["nextlayer"] = lname

keyboardfile = open('yi.txt', 'w', encoding='utf-8')
json.dump(jsondata, keyboardfile, indent=2)
tsvfile.close()
keyboardfile.close()